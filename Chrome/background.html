<script src='http://www.google-analytics.com/ga.js' type='text/javascript'></script>
<script src='cc-nanny-chrome.js' type='text/javascript'></script>
<script src='cc-nanny.js' type='text/javascript'></script>

<script>
function alertUser() {
  chrome.tabs.getSelected(null,
    function(tab) {
      debug("Making pageAction visible");
      chrome.pageAction.show(tab.id);
    });
}

function msgFromListener(r, sender, sendResponse) {
  request = JSON.parse(r);
  debug("Received msg from listener URL = " + request.url + " and action = " + request.formActions);
  if (containsSuspiciousAction(request.formActions)) {
    debug("Cleartext form mailer detected!")
    sendResponse({"flagged": "true"});  
    reportPage(request);
    alertUser();
  } else {
    debug("All forms look OK.")
    sendResponse({"flagged": "false"});  
  }
}

// Add a listener for incoming msgs from listeners.js
chrome.extension.onRequest.addListener(msgFromListener);

loadDatabase();
</script>